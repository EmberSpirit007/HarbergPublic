import{aa as E,ab as _,ac as Y,ad as G,ae as K,af as Q,ag as V,ah as x,ai as X,aj as Z,ak as ee,al as te,am as ae,r as h,Y as ne,i as y,o as $,an as se,H as S,A as re,D as j,ao as oe,ap as ie,aq as ce,C as ue,ar as le,B as de,as as N,L as z,at as pe,au as ye,av as ge,aw as fe,S as L,ax as me,ay as ve,G as he,J as be,K as Ie,az as we}from"./index-CpVBoYKj.js";class Se extends E{constructor({domain:t}){super(`Invalid domain "${_(t)}".`,{metaMessages:["Must be a valid EIP-712 domain."]})}}class Te extends E{constructor({primaryType:t,types:a}){super(`Invalid primary type \`${t}\` must be one of \`${JSON.stringify(Object.keys(a))}\`.`,{docsPath:"/api/glossary/Errors#typeddatainvalidprimarytypeerror",metaMessages:["Check that the primary type is a key in `types`."]})}}class De extends E{constructor({type:t}){super(`Struct type "${t}" is invalid.`,{metaMessages:["Struct type must not be a Solidity type."],name:"InvalidStructTypeError"})}}function ke(e){const{domain:t,message:a,primaryType:n,types:s}=e,r=(d,g)=>{const c={...g};for(const o of d){const{name:f,type:v}=o;v==="address"&&(c[f]=c[f].toLowerCase())}return c},u=s.EIP712Domain?t?r(s.EIP712Domain,t):{}:{},i=(()=>{if(n!=="EIP712Domain")return r(s[n],a)})();return _({domain:u,message:i,primaryType:n,types:s})}function Be(e){const{domain:t,message:a,primaryType:n,types:s}=e,r=(u,i)=>{for(const d of u){const{name:g,type:c}=d,o=i[g],f=c.match(Y);if(f&&(typeof o=="number"||typeof o=="bigint")){const[b,p,I]=f;G(o,{signed:p==="int",size:Number.parseInt(I)/8})}if(c==="address"&&typeof o=="string"&&!K(o))throw new Q({address:o});const v=c.match(V);if(v){const[b,p]=v;if(p&&x(o)!==Number.parseInt(p))throw new X({expectedSize:Number.parseInt(p),givenSize:x(o)})}const w=s[c];w&&(Ee(c),r(w,o))}};if(s.EIP712Domain&&t){if(typeof t!="object")throw new Se({domain:t});r(s.EIP712Domain,t)}if(n!=="EIP712Domain")if(s[n])r(s[n],a);else throw new Te({primaryType:n,types:s})}function Ce({domain:e}){return[typeof(e==null?void 0:e.name)=="string"&&{name:"name",type:"string"},(e==null?void 0:e.version)&&{name:"version",type:"string"},(typeof(e==null?void 0:e.chainId)=="number"||typeof(e==null?void 0:e.chainId)=="bigint")&&{name:"chainId",type:"uint256"},(e==null?void 0:e.verifyingContract)&&{name:"verifyingContract",type:"address"},(e==null?void 0:e.salt)&&{name:"salt",type:"bytes32"}].filter(Boolean)}function Ee(e){if(e==="address"||e==="bool"||e==="string"||e.startsWith("bytes")||e.startsWith("uint")||e.startsWith("int"))throw new De({type:e})}async function Pe(e,t){const{account:a=e.account,domain:n,message:s,primaryType:r}=t;if(!a)throw new Z({docsPath:"/docs/actions/wallet/signTypedData"});const u=ee(a),i={EIP712Domain:Ce({domain:n}),...t.types};if(Be({domain:n,message:s,primaryType:r,types:i}),u.signTypedData)return u.signTypedData({domain:n,message:s,primaryType:r,types:i});const d=ke({domain:n,message:s,primaryType:r,types:i});return e.request({method:"eth_signTypedData_v4",params:[u.address,d]},{retryCount:0})}async function Ae(e,t){const{account:a,connector:n,...s}=t;let r;return typeof a=="object"&&a.type==="local"?r=e.getClient():r=await te(e,{account:a,connector:n}),ae(r,Pe,"signTypedData")({...s,...a?{account:a}:{}})}const l=h([]),C=h(!1),H=h(!1),D=ne();async function xe(){var t,a,n,s,r;if(oe.info(`loadStatsCollection for chain: ${(t=D.chainData)==null?void 0:t.path}`),!((a=D.chainData)!=null&&a.thegraph))return[];const e=await ie.post((n=D.chainData)==null?void 0:n.thegraph,{query:`query MyQuery {
            stats_collection {
              burnNextHourProjected
              burnedLastDay
              burnedLastWeek
              id
              lastUpdatedHour
              mintNextHourProjected
              mintedLastDay
              mintedLastWeek
              outstandingStake
              harbTotalSupply
              stakeTotalSupply
              ringBufferPointer
              totalBurned
              totalMinted
            }
          }`});return console.groupEnd(),(r=(s=e.data)==null?void 0:s.data)==null?void 0:r.stats_collection}const Ne=y(()=>{var e,t,a,n;return m.value?(BigInt((e=m.value)==null?void 0:e.mintedLastWeek)-BigInt((t=m.value)==null?void 0:t.burnedLastWeek))/(BigInt((a=m.value)==null?void 0:a.totalMinted)-BigInt((n=m.value)==null?void 0:n.totalBurned)):0n}),ze=y(()=>{var e;return m.value?BigInt((e=m.value)==null?void 0:e.mintedLastWeek)-BigInt(m.value.burnedLastWeek):0n}),m=y(()=>{var e;if(((e=l.value)==null?void 0:e.length)>0)return l.value[0]}),Le=y(()=>{var e;return((e=l.value)==null?void 0:e.length)>0?BigInt(l.value[0].outstandingStake):0n}),Me=y(()=>{var e;return((e=l.value)==null?void 0:e.length)>0?BigInt(l.value[0].harbTotalSupply):0n}),We=y(()=>{var e;return((e=l.value)==null?void 0:e.length)>0?BigInt(l.value[0].stakeTotalSupply):0n});async function M(){C.value=!0,l.value=await xe(),C.value=!1,H.value=!0}let k=null;h(!1);function Re(){return $(async()=>{var e;((e=l.value)==null?void 0:e.length)===0&&!C.value&&await M()}),k||(console.log("watchChain"),k=se(S,{async onChange(e){await M()}})),re(()=>{k()}),j({profit7d:Ne,nettoToken7d:ze,outstandingStake:Le,harbTotalSupply:Me,stakeTotalSupply:We,initialized:H})}function _e(e,t,a,n,s,r,u,i){return{types:{EIP712Domain:[{name:"name",type:"string"},{name:"version",type:"string"},{name:"chainId",type:"uint256"},{name:"verifyingContract",type:"address"}],Permit:[{name:"owner",type:"address"},{name:"spender",type:"address"},{name:"value",type:"uint256"},{name:"nonce",type:"uint256"},{name:"deadline",type:"uint256"}]},message:{owner:t,spender:a,nonce:n,deadline:s,value:r},domain:{name:i,version:"1",chainId:u,verifyingContract:e},primaryType:"Permit"}}function $e(e){const t=e.slice(0,66),a=`0x${e.slice(66,130)}`,n=ce(`0x${e.slice(130,132)}`);return{r:t,s:a,v:n}}const B=ue();le();const W=de();function Oe(){const e=h(),t=h(!1),a=h(!1);$(async()=>{});const n=y(()=>{const i=B.balance.value;return t.value?"SignTransaction":N.value>i||s.value>i?"NoBalance":a.value?"Waiting":"StakeAble"}),s=y({get(){return e.value||N.value},set(i){e.value=i}}),r=y({get(){return z(s.value,10n**18n)},set(i){s.value=BigInt(i*10**18)}});async function u(i,d){console.log("snatch",{stakingAmount:i,taxRate:d});const g=pe(S),c=ye.find(o=>o.year===d);try{const o=i,f=B.account.address;console.log("receiver",f);const v=BigInt(Date.now())/1000n+1200n,w=await ge(),{types:b,message:p,domain:I,primaryType:T}=_e(fe.contractAddress,g.address,L.contractAddress,me.value,v,o,g.chainId,w);console.log("resultPermitObject",{types:b,message:p,domain:I,primaryType:T});const R=await Ae(S,{domain:I,message:p,primaryType:T,types:b});console.log("signature",{domain:I,message:p,primaryType:T,types:b});const{r:O,s:q,v:F}=$e(R);t.value=!0;const P=await ve(o,g.address,c==null?void 0:c.index,[],v,F,O,q);console.log("hash",P),t.value=!1,a.value=!0;const A=await he(S,{hash:P}),J=be({abi:L.abi,data:A.logs[3].data,topics:A.logs[3].topics}).args,U=Ie(z(J.harbergDeposit,10n**BigInt(B.balance.decimals)));W.showSuccessToast(U,"Success!","You Staked","Check your positions on the<br /> Staker Dashboard","$HARB"),a.value=!1,await we()}catch(o){console.error("error",o),console.log(JSON.parse(JSON.stringify(o))),W.showFailToast(o.name)}finally{t.value=!1,a.value=!1}}return j({stakingAmount:s,stakingAmountNumber:r,state:n,snatch:u})}export{Oe as a,Re as u};
